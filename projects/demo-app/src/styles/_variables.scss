@use 'sass:map';
@use 'sass:meta';

/// Imported from @angular/material@>=12
///
/// Gets a color from a theme palette (the output of mat-palette).
/// The hue can be one of the standard values (500, A400, etc.), one of the three preconfigured
/// hues (default, lighter, darker), or any of the aforementioned suffixed with "-contrast".
///
/// @param {Map} $palette The palette from which to extract a color.
/// @param {String | Number} $hue The hue from the palette to use. If this is a value between 0
//     and 1, it will be treated as opacity.
/// @param {Number} $opacity The alpha channel value for the color.
/// @returns {Color} The color for the given palette, hue, and opacity.
@function get-color-from-palette($palette, $hue: default, $opacity: null) {
    // If hueKey is a number between zero and one, then it actually contains an
    // opacity value, so recall this function with the default hue and that given opacity.
    @if meta.type-of($hue) == number and $hue >= 0 and $hue <= 1 {
        @return get-color-from-palette($palette, default, $hue);
    }

    // We cast the $hue to a string, because some hues starting with a number, like `700-contrast`,
    // might be inferred as numbers by Sass. Casting them to string fixes the map lookup.
    $color: if(map.has-key($palette, $hue), map.get($palette, $hue), map.get($palette, $hue + ''));

    @if (meta.type-of($color) != color) {
        // If the $color resolved to something different from a color (e.g. a CSS variable),
        // we can't apply the opacity anyway so we return the value as is, otherwise Sass can
        // throw an error or output something invalid.
        @return $color;
    }

    @return rgba($color, if($opacity == null, opacity($color), $opacity));
}

@mixin cssVariables($theme) {
    $is-dark-theme: map.get($theme, is-dark);
    $primary: map.get($theme, primary);
    $accent: map.get($theme, accent);
    $warn: map.get($theme, warn);
    $background: map.get($theme, background);
    $foreground: map.get($theme, foreground);


    --ktd-color-primary: #{get-color-from-palette($primary, default)};
    --ktd-color-primary-rgb: #{red(get-color-from-palette($primary, default)), green(get-color-from-palette($primary, default)), blue(get-color-from-palette($primary, default))};
    --ktd-color-primary-contrast:  #{get-color-from-palette($primary, default-contrast)};

    --ktd-color-accent: #{get-color-from-palette($accent, default)};
    --ktd-color-accent-rgb: #{red(get-color-from-palette($accent, default)), green(get-color-from-palette($accent, default)), blue(get-color-from-palette($accent, default))};
    --ktd-color-accent-contrast: #{get-color-from-palette($accent, default-contrast)};

    // Background & foreground (as background contrast)
    --ktd-background-color: #121212;
    --ktd-background-color-rgb: 18,18,18;
    --ktd-background-color-contrast: #ffffff;
    --ktd-background-color-contrast-rgb: 255,255,255;

    --ktd-background-color-step-25: #1a1a1a;
    --ktd-background-color-step-50: #1e1e1e;
    --ktd-background-color-step-100: #2a2a2a;
    --ktd-background-color-step-150: #363636;
    --ktd-background-color-step-200: #414141;
    --ktd-background-color-step-250: #4d4d4d;
    --ktd-background-color-step-300: #595959;
    --ktd-background-color-step-350: #656565;
    --ktd-background-color-step-400: #717171;
    --ktd-background-color-step-450: #7d7d7d;
    --ktd-background-color-step-500: #898989;

    // steps in rgb
    --ktd-background-color-step-150-rgb: 54,54,54;

    --ktd-item-background: #1A1B1E;
    --ktd-border-color: #4a4a4a;
    --ktd-border-color-light: #4a4e51;

    // Background light
    --ktd-background-color-light: #222428;
    --ktd-background-color-light-rgb: 34,36,40;
    --ktd-background-color-light-contrast: #ffffff;
    --ktd-background-color-light-contrast-rgb: 255,255,255;
    --ktd-background-color-light-darker: #1e2023;
    --ktd-background-color-light-lighter: #383a3e;

    // Custom SVG variable colors
    --ktd-svg-color: #ffffff;
    --ktd-svg-color-complementary: #9b9b9b;
    --ktd-svg-color-rgb: 255,255,255;
    --ktd-svg-color-complementary-rgb: 155,155,155;

    // text colors
    --ktd-text-color: map.get($foreground, text);
    --ktd-text-accent-color: rgba(var(--ktd-color-accent-rgb), 0.94);
}
